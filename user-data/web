#reference: https://gist.github.com/matthewflanneryaustralia/37001f99dddcfa486dc637607a2b3990

#!/bin/bash
cat > /tmp/startup.sh << EOF
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash

echo 'export NVM_DIR="$HOME/.nvm"' >> /home/ubuntu/.bashrc
echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm' >> /home/ubuntu/.bashrc
echo '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion' >> /home/ubuntu/.bashrc

# Dot source the files to ensure that variables are available within the current shell
. /home/ubuntu/.nvm/nvm.sh
. /home/ubuntu/.profile
. /home/ubuntu/.bashrc

#install 
nvm install stable
nvm use stable
npm install -g pm2
EOF

chown ubuntu:ubuntu /tmp/startup.sh
chmod a+x /tmp/startup.sh
sleep 1; su - ubuntu -c "/tmp/startup.sh > /tmp/startup.log"
